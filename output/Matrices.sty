\newcommand{\mat}[3]{\def\argII{,#2}\ifx&#2&\def\argII{}\fi\mathcal{M}_{#1\argII}\l#3\r}
\newcommand{\sym}[2]{\mathcal{S}_{#1}\l#2\r}
\newcommand{\ant}[2]{\mathcal{A}_{#1}\l#2\r}
\newcommand{\diag}[2]{\mathcal{D}_{#1}\l#2\r}
\newcommand{\ts}[2]{\mathcal{T}_{#1}^+\l#2\r}
\newcommand{\ti}[2]{\mathcal{T}_{#1}^-\l#2\r}
\let\olddet\det
\renewcommand{\det}[1]{\olddet\l#1\r}
\DeclareMathOperator{\oldgl}{GL}
\newcommand{\gl}[2]{\oldgl_{#1}\l#2\r}
\usepackage{tikz}
\usetikzlibrary{matrix,calc,fit}
\makeatletter
\@ifclassloaded{beamer}{
    \DeclareMathSymbol{\mcdot}{\mathpunct}{symbols}{"01}
    \def\oldmdots{\mathinner{\hbox{$\mcdot$}\hbox{$\mcdot$}\hbox{$\mcdot$}}}
    \def\oldddots{\mathinner{\raise11pt\vbox{\hbox{$\mcdot$}}\raise5.5pt\hbox{$\mcdot$}\raise0pt\hbox{$\mcdot$}}}
    \def\oldvdots{\mathinner{\raise11pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise5.5pt\hbox{$\mcdot$}\mkern-5mu\raise0pt\hbox{$\mcdot$}}}
    \def\oldxdots{\mathinner{\raise11pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise0pt\hbox{$\mcdot$}\raise5.5pt\hbox{$\mcdot$}\raise11pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise0pt\hbox{$\mcdot$}}}
    \newcommand{\mdots}{\raise1.5pt\hbox{$\oldmdots$}}
    \renewcommand{\ddots}{\vcenter{\hbox{$\lower1pt\hbox{$\oldddots$}$}}}
    \renewcommand{\vdots}{\vcenter{\hbox{$\lower1pt\hbox{$\oldvdots$}$}}}
    \newcommand{\xdots}{\vcenter{\hbox{$\lower1pt\hbox{$\oldxdots$}$}}}
    \newcommand{\tmatrix}[1][]{\def\argI{#1}\tmptmatrix}
    \newcommand{\tmptmatrix}[4][]{
    \begin{tikzpicture}[baseline={([yshift=-0.5ex]m.center)}]
    \matrix (m) [
            ampersand replacement=\&,
            matrix of math nodes,
            left delimiter=#2,
            right delimiter=#4,
            anchor=center,
            minimum width=25pt,
            minimum height=25pt,
            row sep=5pt,
            column sep=5pt,
            inner sep=0pt,
            #1
        ] {#3};
        \argI
    \end{tikzpicture}}
}{
    \DeclareMathSymbol{\mcdot}{\mathpunct}{symbols}{"01}
    \def\oldmdots{\mathinner{\hbox{$\mcdot$}\hbox{$\mcdot$}\hbox{$\mcdot$}}}
    \def\oldddots{\mathinner{\raise7pt\vbox{\hbox{$\mcdot$}}\raise3.5pt\hbox{$\mcdot$}\raise0pt\hbox{$\mcdot$}}}
    \def\oldvdots{\mathinner{\raise7pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise3.5pt\hbox{$\mcdot$}\mkern-5mu\raise0pt\hbox{$\mcdot$}}}
    \def\oldxdots{\mathinner{\raise7pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise0pt\hbox{$\mcdot$}\raise3.5pt\hbox{$\mcdot$}\raise7pt\vbox{\hbox{$\mcdot$}}\mkern-5mu\raise0pt\hbox{$\mcdot$}}}
    \newcommand{\mdots}{\raise0.5pt\hbox{$\oldmdots$}}
    \renewcommand{\ddots}{\vcenter{\hbox{$\raise1pt\hbox{$\oldddots$}$}}}
    \renewcommand{\vdots}{\vcenter{\hbox{$\raise1pt\hbox{$\oldvdots$}$}}}
    \newcommand{\xdots}{\vcenter{\hbox{$\raise1pt\hbox{$\oldxdots$}$}}}
    \newcommand{\tmatrix}[1][]{\def\argI{#1}\tmptmatrix}
    \newcommand{\tmptmatrix}[4][]{
    \begin{tikzpicture}[baseline={([yshift=-0.5ex]m.center)}]
    \matrix (m) [
            ampersand replacement=\&,
            matrix of math nodes,
            left delimiter=#2,
            right delimiter=#4,
            anchor=center,
            minimum width=15pt,
            minimum height=15pt,
            row sep=3.5pt,
            column sep=3.5pt,
            inner sep=0pt,
            #1
        ] {#3};
        \argI
    \end{tikzpicture}}
}
\makeatother
\newcommand\mtxvline[2]{
\pgfmathparse{int(#2+1)}
\coordinate (temp-l) at (m-1-#2);
\foreach \x in {2,...,\the\pgfmatrixcurrentrow} {
    \coordinate (temp-l) at ($(temp-l) +(m-\x-#2)$);
}
\node [fit=(temp-l)] (fit-l) {};
\coordinate (temp-r) at (m-1-\pgfmathresult);
\foreach \x in {2,...,\the\pgfmatrixcurrentrow} {
    \coordinate (temp-r) at ($(temp-r) +(m-\x-\pgfmathresult)$);
}
\node [fit=(temp-r)] (fit-r) {};
\path (fit-l.east) -- (fit-r.west) coordinate[midway] (X);
\draw[#1] (X |- m.north) --  (X |- m.south);
}
\newcommand\mtxhline[2]{
\pgfmathparse{int(#2+1)}
\coordinate (temp-t) at (m-#2-1);
\foreach \x in {2,...,\the\pgfmatrixcurrentcolumn} {
    \coordinate (temp-t) at ($(temp-t) +(m-#2-\x)$);
}
\node [fit=(temp-t)] (fit-t) {};
\coordinate (temp-s) at (m-\pgfmathresult-1);
\foreach \x in {2,...,\the\pgfmatrixcurrentcolumn} {
    \coordinate (temp-s) at ($(temp-s) +(m-\pgfmathresult-\x)$);
}
\node [fit=(temp-s)] (fit-s) {};
\path (fit-t.east) -- (fit-s.west) coordinate[midway] (X);
\draw[#1] (X -| m.west) --  (X -| m.east);
}