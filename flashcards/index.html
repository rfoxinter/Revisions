<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="description" content="Révisions">
    <link rel="icon" href="https://rfoxinter.github.io/bac/English/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Révisions</title>
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap&text=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%C3%A9%C3%A8%C3%A0%C3%B9%C3%890123456789.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0&display=swap">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/main.css">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/normalize.css">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/style.css">
    <style>
        svg {
            max-width: 100%;
            max-height: calc(max(20vh, 120px)) !important;
            fill: #606c71;
            width: unset !important;
            vertical-align: middle;
        }
        path {
            stroke: #606c71;
        }
        button {
            display: inline-block;
            width: 25vw;
            min-height: 40px;
        }
    </style>
    <script type="text/javascript" defer>
        function shuffleArray(array) {
            for (let i = 0; i < array.length-1; ++i) {
                const j = Math.floor(Math.random() * (array.length));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
        function copyArray(array) {
            var cparr = new Array(array.length)
            for (let i = 0; i < array.length; ++i) {
                cparr[i] = array[i];
            }
            return cparr;
        }
        var title; var sh_quest; var sh_qr; var n; var ques; var fst; var q; var viewed; var nth; var svgcode; var arr = []; var wrong = []; var qr = [0, 1];
        var file = atob(new URLSearchParams(document.location.search.substring(1)).get("file"));
        async function loadModule(file) {
            const response = await fetch('./' + file + '/info.txt');
            const jsCode = await response.text();
            const lst = jsCode.split("\n");
            title = eval(lst[0]);
            sh_quest = eval(lst[1]);
            sh_qr = eval(lst[2]);
            n = eval(lst[3]);
            fst = eval(lst[4]);

            q = true;
            viewed = false;
            nth = 0;

            document.title = title.replace('&ndash;', '-').replace('<i>', '').replace('</i>', '');
            ques = copyArray(n);

            document.getElementById('title').innerHTML = title;
            if (sh_quest) {shuffleArray(ques);} 
        }
        async function get_code(file, ques, type) {
            var response = await fetch('./' + file + '/' + type + ques + '.svg');
            svgcode = await response.text();
        }
        async function fill_svg(file) {
            await loadModule(file);
            arr = new Array(2*n.length);
            await get_code(file, ques[0], 'Q');
            arr[2*ques[0]-2] = svgcode;
            document.getElementById('flashcard').innerHTML = arr[2*ques[0]-2];
            await get_code(file, ques[0], 'R');
            arr[2*ques[0]-1] = svgcode;
            for (let i = 1; i < n.length; i++) {
                await get_code(file, ques[i], 'Q');
                arr[2*ques[i]-2] = svgcode;
                await get_code(file, ques[i], 'R');
                arr[2*ques[i]-1] = svgcode;
            }
        }
        fill_svg(file);
        function reverse_card() {
            if (q) {
                document.getElementById('flashcard').innerHTML = arr[2*ques[nth]-2+qr[Number(q)]];
                document.getElementById('flip').innerHTML = 'Voir la question';
                q = false;
                viewed = true;
            } else {
                document.getElementById('flashcard').innerHTML = arr[2*ques[nth]-2+qr[Number(q)]];
                document.getElementById('flip').innerHTML = 'Voir la réponse';
                q = true;
            }
            if (viewed) {
                document.getElementById('incor').disabled = false;
                document.getElementById('corr').disabled = false;
            } else {
                document.getElementById('incor').disabled = true;
                document.getElementById('corr').disabled = true;
            }
        }
        function new_card(corr) {
            if (nth + 1 == ques.length) {
                if (!corr) {wrong.push(ques[nth]);}
                nth += 1;
                document.getElementById('flashcard').innerHTML = "Terminé";
                document.getElementById('flip').disabled = true;
                if (wrong.length > 0) {document.getElementById('incor').disabled = false;} else {document.getElementById('incor').disabled = true;}
                document.getElementById('corr').disabled = false;
                document.getElementById('incor').innerText = "Revoir";
                document.getElementById('corr').innerText = "Recommencer";
            } else if (nth + 1 > ques.length) {
                document.getElementById('flip').disabled = false;
                document.getElementById('incor').innerText = "Réponse incorrecte";
                document.getElementById('corr').innerText = "Réponse correcte";
                if (!corr) {
                    ques = copyArray(wrong);
                    shuffleArray(ques);
                    wrong = [];
                    nth = 0;
                    q = false;
                    viewed = false;
                    qr = [0, 1];
                    if (sh_qr && !fst[ques[nth]-1]) {shuffleArray(qr);}
                    reverse_card()
                } else {
                    ques = copyArray(n);
                    shuffleArray(ques);
                    wrong = [];
                    nth = 0;
                    q = false;
                    viewed = false;
                    qr = [0, 1];
                    if (sh_qr && !fst[ques[nth]-1]) {shuffleArray(qr);}
                    reverse_card()
                }
            } else {
                if (!corr) {wrong.push(ques[nth]);}
                nth += 1;
                q = false;
                viewed = false;
                qr = [0, 1];
                if (sh_qr && !fst[ques[nth]-1]) {shuffleArray(qr);}
                reverse_card();
            }
        }
    </script>
</head>
<body>
    <div id="overlay"></div>
    <header class="page-header">
        <h1 id="title"></h1>       
    </header>
    <main class="main-content">
        <p style="text-align: center; height: calc(max(50vh,300px)); margin-bottom: 0.5rem;">
            <span style="display: flex; align-items: center; justify-content: center; height: 100%;">
                <span id="flashcard" style="scale: 2.5; max-width: 40%;"></span>
            </span>
        </p>
        <p style="text-align: center;">
            <button id="flip" onclick="reverse_card()">Voir la réponse</button>
        </p>
        <p>
            <button id="incor" onclick="new_card(false)" style="position: relative; left: 15vw; color: #EC7063;" disabled>Réponse incorrecte</button><button id="corr" onclick="new_card(true)" style="position: relative; left: calc(100% - 65vw); color: #159957;" disabled>Réponse correcte</button>
        </p>
    </main>
    <footer class="site-footer">
        <a href="./MP2I/"><img src="https://rfoxinter.github.io/bac/English/home.svg" class="home" alt="home"></a>
    </footer>
</body>
</html>
