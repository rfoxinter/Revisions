<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="utf-8">
    <meta name="description" content="Révisions">
    <link rel="icon" href="https://rfoxinter.github.io/bac/English/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Révisions</title>
    <meta name="theme-color" content="#157878">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap&text=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz%C3%A90123456789.">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@48,400,0,0&display=swap">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/main.css">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/normalize.css">
    <link rel="stylesheet" type="text/css" href="https://rfoxinter.github.io/bac/English/style.css">
    <style>
        svg {max-width: 100%;}
        button {
            display: inline-block;
            width: 15vw;
        }
    </style>
<!-- <script type="text/javascript" src="main.js"></script> -->
    <script type="text/javascript" defer>

          function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
        }
        var title; var sh_quest; var sh_qr; var n; var fst; var q; var viewed; var nth; var ques; var svgcode; var arr = [];
        let file = atob(new URLSearchParams(document.location.search.substring(1)).get("file"));
        async function loadModule(file) {
  const response = await fetch('./' + file + '/info.txt');
  const jsCode = await response.text();
  const lst = jsCode.split("\n");
  // You can now use the variables defined in js
  title = eval(lst[0]);
  sh_quest = eval(lst[1]);
  sh_qr = eval(lst[2]);
  n = eval(lst[3]);
  fst = eval(lst[4]);

        q = true;
        viewed = false;
        nth = 0;
ques = shuffleArray(n);

        
document.getElementById('title').innerHTML = title;
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        if (sh_quest) {ques = shuffleArray(n);} else {ques = n; /*Implement a copy function*/}
        document.getElementById('flashcard').setAttribute('src', './' + file + '/Q'+ques[0]+'.svg');   
    }
        async function get_code(file, ques, type) {

            var response = await fetch('./' + file + '/'+type+ques+'.svg');
                svgcode = await response.text();
        }

        async function fill_svg(file) {
            await loadModule(file);
            arr = new Array(2*n.length);
            await get_code(file, ques[0], 'Q');
            arr[0] = svgcode;
            document.getElementById('flashcard').innerHTML = arr[0];
            await get_code(file, ques[0], 'R');
            arr[1] = svgcode;
            for (let i = 1; i < n.length; i++) {
                await get_code(file, ques[i], 'Q');
                arr[2*i] = svgcode;
                await get_code(file, ques[i], 'R');
                arr[2*i+1] = svgcode;
            
                
            }
        }

        async function load(file) {
            await fill_svg(file);
            
        }
load(file);
  


  // Do something with the variables here
// }
//         fetch('./' + file + '/js')
//   .then(response => response.text())
//   .then(jsCode => {
//     lst = jsCode.split("\n")
//     // You can now use the variables defined in js
//     title = eval(lst[0]);
//     sh_quest = lst[1];
//     sh_qr = lst[2];
//     n = lst[3];
//     fst = lst[4];
// });

        // System.import("./${file}/js").then(function(m) {
        //     console.log(m.title);
        //     console.log(m.n);
        //     // access other variables as needed
        // })
        // // import {info} from "./${file}/js";

        
        
        function reverse_card() {
            if (q) {
                document.getElementById('flashcard').innerHTML = arr[2*ques[nth]-1];
                document.getElementById('flip').innerHTML = 'Voir la question';
                q = false;
                viewed = true;
            } else {
                document.getElementById('flashcard').innerHTML = arr[2*ques[nth]-2];
                document.getElementById('flip').innerHTML = 'Voir la réponse';
                q = true;
            }
            if (viewed) {
                document.getElementById('next').disabled = false;
            } else {
                document.getElementById('next').disabled = true;
            }
        }
        function new_card() {
            if (viewed) {
                nth += 1;
                q = false;
                viewed = false;
                reverse_card();
                if (nth >= n.length) {
                    document.getElementById('flashcard').innerHTML = "Terminé";
                document.getElementById('next').disabled = true;
                document.getElementById('flip').disabled = true;
                }
            }
        }

    </script>
</head>
<body>
    <div id="overlay"></div>
    <header class="page-header">
        <h1 id="title"></h1>       
    </header>
    <main class="main-content">
        <p style="text-align: center; height: calc(max(60vh,300px));">
            <span style="display: flex; align-items: center; justify-content: center; height: 100%;">
                <span id="flashcard" style="scale: 2.5; max-width: 40%;"></span>
            </span>
        </p>
        <p>
            <button id="flip" onclick="reverse_card()" style="position: relative; left: 25vw;">Voir la réponse</button><button id="next" onclick="new_card()" style="position: relative; left: calc(100% - 55vw);" disabled>Question suivante</button>
        </p>
          
        
    </main>
    <footer class="site-footer">
        <a href="https://rfoxinter.github.io/revisions/"><img src="https://rfoxinter.github.io/bac/English/home.svg" class="home" alt="home"></a>
    </footer>
</body>
</html>
